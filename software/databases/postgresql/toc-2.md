# PostgreSQL-Specific Study Guide — Table of Contents

> **Prerequisites:** This guide assumes knowledge of the General SQL TOC (Modules 1–12). Everything here is either PostgreSQL-exclusive, PostgreSQL-specific behavior, or a meaningful difference from standard SQL.

---

## Module 1: PostgreSQL Architecture

### 1.1 PostgreSQL History and Philosophy
- Origins at UC Berkeley (INGRES → POSTGRES → PostgreSQL)
- The PostgreSQL Global Development Group (PGDG)
- Release cycle and versioning (major vs. minor versions)
- PostgreSQL vs. MySQL vs. Oracle vs. SQL Server — key philosophical differences
- Open-source ecosystem and extensions model

### 1.2 Process Architecture
- Multi-process vs. multi-thread model
- The Postmaster process
- Backend processes (one per connection)
- Background workers:
  - `autovacuum` launcher and workers
  - `WAL writer`
  - `checkpointer`
  - `background writer`
  - `stats collector`
  - `logical replication launcher`
- How a query travels from client to result

### 1.3 Memory Architecture
- Shared memory:
  - `shared_buffers` — the main buffer pool
  - `WAL buffers`
  - `lock table`
- Per-process memory:
  - `work_mem` — for sorts and hash joins
  - `maintenance_work_mem` — for VACUUM, CREATE INDEX
  - `temp_buffers` — for temporary tables
- `effective_cache_size` — planner hint for OS cache
- Huge pages support

### 1.4 Storage Architecture
- Heap files and page structure (8KB pages by default)
- Page layout:
  - Page header
  - Item identifiers (line pointers)
  - Tuples (rows)
  - Free space
- TOAST — The Oversized Attribute Storage Technique:
  - TOAST strategies: `PLAIN`, `EXTENDED`, `EXTERNAL`, `MAIN`
  - TOAST tables and TOAST indexes
  - Compression: `pglz` and `lz4`
- Tablespaces — storing objects on different disks
- `pg_filenode` — relation to physical file mapping
- Fork types: main fork, FSM fork, VM fork

### 1.5 The PostgreSQL Catalog
- `pg_catalog` schema
- Key system tables:
  - `pg_class` — tables, indexes, sequences, views
  - `pg_attribute` — columns
  - `pg_type` — data types
  - `pg_namespace` — schemas
  - `pg_proc` — functions and procedures
  - `pg_constraint` — constraints
  - `pg_index` — index metadata
  - `pg_statistic` — planner statistics
- `information_schema` vs. `pg_catalog`
- Querying the catalog for metadata

---

## Module 2: PostgreSQL Data Types

### 2.1 Numeric Types (PostgreSQL-specific behavior)
- `SERIAL`, `SMALLSERIAL`, `BIGSERIAL` — legacy auto-increment
- `IDENTITY` columns: `GENERATED ALWAYS AS IDENTITY`, `GENERATED BY DEFAULT AS IDENTITY`
- `NUMERIC` vs. `FLOAT` precision traps
- `MONEY` type — caveats and locale dependency
- Numeric operators: `^` (power), `|/` (square root), `||/` (cube root), `@` (absolute value)

### 2.2 String Types (PostgreSQL-specific behavior)
- `TEXT` — truly unlimited, preferred over `VARCHAR`
- `CHAR(n)` padding behavior
- `"char"` — single-byte internal type (different from `CHAR`)
- `NAME` — internal 63-byte identifier type
- String operators: `||` (concatenation), `LIKE`, `ILIKE`, `SIMILAR TO`
- Regular expressions: `~`, `~*`, `!~`, `!~*`

### 2.3 PostgreSQL-Exclusive Types
- **Arrays:**
  - Declaring array columns: `INT[]`, `TEXT[][]`
  - Array constructors: `ARRAY[1, 2, 3]`
  - Operators: `@>` (contains), `<@` (contained by), `&&` (overlap), `||` (concatenate)
  - Functions: `array_agg()`, `unnest()`, `array_length()`, `array_append()`
  - Indexing arrays with GIN
- **Composite Types:**
  - Defining custom row types
  - Using composite types in queries
  - Accessing fields with dot notation
- **Range Types:**
  - Built-in: `int4range`, `int8range`, `numrange`, `tsrange`, `tstzrange`, `daterange`
  - Range operators: `@>`, `<@`, `&&`, `-|-` (adjacent), `+` (union), `*` (intersection), `-` (difference)
  - Exclusion constraints with range types
  - Custom range types
- **Domain Types:**
  - Creating domains with `CREATE DOMAIN`
  - Adding constraints to domains
  - Reusable custom types with validation
- **Enumerated Types (ENUM):**
  - `CREATE TYPE mood AS ENUM ('sad', 'ok', 'happy')`
  - Adding values: `ALTER TYPE ... ADD VALUE`
  - Ordering of enum values
- **Geometric Types:**
  - `POINT`, `LINE`, `LSEG`, `BOX`, `PATH`, `POLYGON`, `CIRCLE`
  - Geometric operators and functions
- **Network Address Types:**
  - `INET` — IPv4 and IPv6 addresses
  - `CIDR` — network addresses
  - `MACADDR`, `MACADDR8`
  - Network operators: `<<` (subnet), `>>` (supernet)
- **Bit String Types:** `BIT(n)`, `BIT VARYING(n)`
- **UUID Type:** `UUID` and `gen_random_uuid()`
- **XML Type:** native XML storage and XPath
- **JSON vs. JSONB:**
  - `JSON` — stored as text, preserves whitespace and key order
  - `JSONB` — stored as binary, parsed and indexed
  - JSONB operators: `->`, `->>`, `#>`, `#>>`, `@>`, `<@`, `?`, `?|`, `?&`
  - JSONB functions: `jsonb_set()`, `jsonb_insert()`, `jsonb_strip_nulls()`
  - Indexing JSONB with GIN
  - JSON path: `jsonb_path_query()`
- **`pg_lsn`** — Log Sequence Number type
- **`TSVECTOR` and `TSQUERY`** — full-text search types (covered in Module 6)

### 2.4 Date and Time (PostgreSQL-specific behavior)
- `TIMESTAMP` vs. `TIMESTAMPTZ` — always prefer `TIMESTAMPTZ`
- Timezone handling and `TimeZone` setting
- `AT TIME ZONE` operator
- Special values: `'infinity'`, `'-infinity'`, `'epoch'`
- Date/time arithmetic with `INTERVAL`
- `EXTRACT()` vs. `DATE_PART()` — differences
- `DATE_TRUNC()` — truncating to a time unit
- `age()` function
- `generate_series()` for date ranges

---

## Module 3: PostgreSQL SQL Extensions

### 3.1 DDL Extensions
- `CREATE TABLE IF NOT EXISTS`
- `CREATE TABLE ... LIKE` — copying table structure
- `CREATE TABLE ... INHERITS` — table inheritance
- `CREATE TABLE ... PARTITION BY` — declarative partitioning
- `UNLOGGED` tables — faster writes, no WAL, lost on crash
- `TEMPORARY` / `TEMP` tables — session-scoped
- Column storage options: `SET STORAGE`
- `GENERATED ALWAYS AS (expression) STORED` — computed columns
- `CREATE TYPE` — custom base, composite, enum, range types
- `CREATE DOMAIN` — constrained types
- `CREATE COLLATION` — custom sort orders
- `ALTER TABLE ... SET (fillfactor = n)` — page fill tuning
- `COMMENT ON` — documenting objects

### 3.2 DML Extensions
- `INSERT ... ON CONFLICT` — true upsert
  ```sql
  INSERT INTO products (id, name, price)
  VALUES (1, 'Widget', 9.99)
  ON CONFLICT (id) DO UPDATE
  SET price = EXCLUDED.price;
  ```
- `ON CONFLICT DO NOTHING`
- `EXCLUDED` pseudo-table in upsert
- `RETURNING` clause — getting data back from DML
  ```sql
  INSERT INTO employees (first_name, salary)
  VALUES ('Bob', 60000)
  RETURNING employee_id, first_name;
  ```
- `RETURNING` with UPDATE and DELETE
- `UPDATE ... FROM` — update with join syntax
- `DELETE ... USING` — delete with join syntax

### 3.3 Query Extensions
- `DISTINCT ON (expression)` — PostgreSQL-specific
  ```sql
  SELECT DISTINCT ON (department_id)
      department_id, first_name, salary
  FROM employees
  ORDER BY department_id, salary DESC;
  ```
- `LIMIT` and `OFFSET` syntax
- `FETCH FIRST n ROWS WITH TIES`
- Lateral joins with `LATERAL`
  ```sql
  SELECT e.first_name, recent.order_date
  FROM employees e
  JOIN LATERAL (
      SELECT order_date FROM orders
      WHERE employee_id = e.employee_id
      ORDER BY order_date DESC LIMIT 1
  ) AS recent ON true;
  ```
- `TABLESAMPLE` — sampling rows from a table
  - `SYSTEM` vs. `BERNOULLI` methods
- `VALUES` as a standalone query
- `WITH ORDINALITY` — adding row numbers to set-returning functions
- `GROUPING SETS`, `ROLLUP`, `CUBE` (standard but notable)

### 3.4 PL/pgSQL — Procedural Language
- PL/pgSQL vs. standard SQL functions
- Block structure: `DECLARE`, `BEGIN`, `EXCEPTION`, `END`
- Variable declaration and assignment
- Control structures:
  - `IF / ELSIF / ELSE`
  - `CASE`
  - `LOOP`, `EXIT WHEN`
  - `WHILE`
  - `FOR` (integer and query loops)
  - `FOREACH` over arrays
- `RETURN`, `RETURN NEXT`, `RETURN QUERY`
- Exception handling:
  - `RAISE NOTICE`, `RAISE WARNING`, `RAISE EXCEPTION`
  - `SQLSTATE` and `SQLERRM`
  - `GET DIAGNOSTICS`
- Dynamic SQL with `EXECUTE`
- `PERFORM` — executing a query and discarding results
- Cursors in PL/pgSQL
- Trigger functions in PL/pgSQL
- Debugging PL/pgSQL with `RAISE`

### 3.5 Other Procedural Languages
- `PL/Python` — `plpython3u`
- `PL/Perl` — `plperl`
- `PL/Tcl` — `pltcl`
- `PL/v8` — JavaScript via V8 engine
- `PL/R` — R language for statistical computing
- Trusted vs. untrusted languages

### 3.6 Full-Text Search
- `TSVECTOR` — processed document representation
- `TSQUERY` — search query representation
- `to_tsvector(config, text)` and `to_tsquery(config, query)`
- Text search configurations (dictionaries, parsers)
- `@@` match operator
- `ts_rank()` and `ts_rank_cd()` — relevance ranking
- `ts_headline()` — highlighted results
- GIN and GiST indexes for full-text search
- Creating dedicated `tsvector` columns with triggers
- Custom text search configurations

---

## Module 4: PostgreSQL Indexing (Extensions)

### 4.1 Index Types Unique to PostgreSQL
- **GiST — Generalized Search Tree:**
  - Use cases: geometric, range, full-text, nearest-neighbor
  - `KNN-GiST` — $k$-nearest neighbor searches
- **GIN — Generalized Inverted Index:**
  - Use cases: arrays, JSONB, full-text search
  - `fastupdate` option — buffered inserts
  - GIN vs. GiST trade-offs: GIN faster to search, GiST faster to update
- **SP-GiST — Space-Partitioned GiST:**
  - Use cases: IP addresses, geometric points, ranges
  - Quadtrees, k-d trees, radix trees
- **BRIN — Block Range Index:**
  - Very small index for naturally ordered data
  - Use case: time-series tables, append-only logs
  - `pages_per_range` parameter
  - Storage size: $O(\frac{N}{pages\_per\_range})$ vs. B-Tree $O(N \log N)$
  - When BRIN beats B-Tree

### 4.2 Index Features Unique to PostgreSQL
- **Partial Indexes:**
  ```sql
  CREATE INDEX idx_active_users ON users (email)
  WHERE active = true;
  ```
- **Expression Indexes:**
  ```sql
  CREATE INDEX idx_lower_email ON users (LOWER(email));
  ```
- **Covering Indexes with INCLUDE:**
  ```sql
  CREATE INDEX idx_emp_cover ON employees (department_id)
  INCLUDE (first_name, salary);
  ```
- **Concurrent Index Building:**
  ```sql
  CREATE INDEX CONCURRENTLY idx_name ON table (column);
  ```
- **Index-only scans** and visibility map
- `fillfactor` for indexes — tuning for update-heavy tables
- Operator classes and operator families
- Custom operator classes for custom types
- `pg_index` — monitoring index usage
- `pg_stat_user_indexes` — identifying unused indexes

---

## Module 5: PostgreSQL Storage and MVCC

### 5.1 MVCC Deep Dive (PostgreSQL-specific)
- `xmin` and `xmax` — transaction visibility fields
- `ctid` — physical row location `(page, offset)`
- Transaction ID (XID) and snapshot isolation
- `txid_current()`, `txid_current_snapshot()`
- Dead tuples — why they exist
- Tuple versions and HOT updates (Heap Only Tuple)
- HOT chains — reducing index bloat
- `pg_visibility` extension — inspecting the visibility map

### 5.2 VACUUM Deep Dive
- Why VACUUM exists (MVCC dead tuples)
- `VACUUM` vs. `VACUUM FULL` vs. `VACUUM ANALYZE`
- What VACUUM does:
  - Marks dead tuples as reusable
  - Updates the Free Space Map (FSM)
  - Updates the Visibility Map (VM)
  - Advances `relfrozenxid` to prevent XID wraparound
- Transaction ID wraparound problem:
  - XIDs are 32-bit: max $2^{32} \approx 4$ billion
  - `autovacuum_freeze_max_age` — when forced freeze kicks in
  - Emergency autovacuum for anti-wraparound
- `VACUUM FULL` — rewrites entire table, requires lock
- `pg_repack` — online equivalent of VACUUM FULL
- Autovacuum tuning parameters:
  - `autovacuum_vacuum_scale_factor`
  - `autovacuum_vacuum_threshold`
  - `autovacuum_vacuum_cost_delay`
  - Per-table autovacuum settings with `ALTER TABLE ... SET`
- Monitoring bloat:
  - `pg_stat_user_tables` — `n_dead_tup`, `last_autovacuum`
  - `pgstattuple` extension
  - Bloat estimation queries

### 5.3 Write-Ahead Logging (WAL) Deep Dive
- What WAL is and why it ensures durability
- WAL record structure
- LSN — Log Sequence Number: `pg_current_wal_lsn()`
- WAL segments — 16MB files in `pg_wal/`
- Checkpoints:
  - What happens at a checkpoint
  - `checkpoint_completion_target`
  - `max_wal_size`, `min_wal_size`
- WAL compression: `wal_compression`
- WAL levels:
  - `minimal` — crash recovery only
  - `replica` — streaming replication
  - `logical` — logical decoding
- `pg_waldump` — inspecting WAL records
- WAL archiving: `archive_mode`, `archive_command`

---

## Module 6: PostgreSQL Performance Tuning

### 6.1 Configuration Tuning
- Memory tuning:
  - `shared_buffers` — typically 25% of RAM
  - `effective_cache_size` — typically 75% of RAM
  - `work_mem` — per sort/hash operation, beware of multiplier effect
  - `maintenance_work_mem` — for VACUUM and index builds
- Checkpoint tuning:
  - `checkpoint_completion_target = 0.9`
  - `max_wal_size`
- Planner settings:
  - `random_page_cost` — lower for SSDs (1.1–2.0)
  - `effective_io_concurrency` — for parallel I/O
  - `default_statistics_target` — more samples, better estimates
- Parallel query settings:
  - `max_parallel_workers_per_gather`
  - `max_parallel_workers`
  - `min_parallel_table_scan_size`

### 6.2 Parallel Query Execution
- How PostgreSQL parallelizes queries
- Parallel sequential scans
- Parallel index scans
- Parallel aggregates
- Parallel joins
- `EXPLAIN` nodes: `Gather`, `Gather Merge`
- `parallel_setup_cost` and `parallel_tuple_cost`
- Forcing or disabling parallelism

### 6.3 Planner Statistics and Hints
- `ANALYZE` — collecting column statistics
- `pg_statistic` and `pg_stats` views
- Statistics targets per column:
  ```sql
  ALTER TABLE orders ALTER COLUMN status
  SET STATISTICS 500;
  ```
- Extended statistics:
  - `CREATE STATISTICS` — multi-column correlations
  - `n-distinct`, `dependencies`, `MCV` (Most Common Values)
- Planner hints (PostgreSQL has no hint syntax natively):
  - `pg_hint_plan` extension
  - Workarounds: `SET enable_seqscan = off`, CTEs as optimization fences

### 6.4 Partitioning (PostgreSQL-specific)
- Declarative partitioning syntax:
  ```sql
  CREATE TABLE measurements (
      city_id INT,
      recorded_at TIMESTAMPTZ,
      value NUMERIC
  ) PARTITION BY RANGE (recorded_at);

  CREATE TABLE measurements_2024
  PARTITION OF measurements
  FOR VALUES FROM ('2024-01-01') TO ('2025-01-01');
  ```
- Partition pruning: static and dynamic
- `enable_partition_pruning` setting
- Default partition
- Partition-wise joins and aggregates
- Attaching and detaching partitions online
- Sub-partitioning
- Partitioning vs. table inheritance (legacy)

### 6.5 `EXPLAIN` and `EXPLAIN ANALYZE` Deep Dive
- Node types and what they mean
- Cost notation: `cost=startup..total`
- `actual time`, `rows`, `loops`
- `Buffers` output: `shared hit`, `shared read`, `dirtied`, `written`
- `Planning Time` vs. `Execution Time`
- `JIT` — Just-In-Time compilation:
  - When JIT kicks in
  - `jit`, `jit_above_cost`, `jit_optimize_above_cost`
- `FORMAT JSON` / `FORMAT YAML` for machine-readable plans
- Tools: `pgMustard`, `explain.dalibo.com`, `auto_explain` extension

---

## Module 7: PostgreSQL Replication

### 7.1 Physical / Streaming Replication
- WAL-based streaming replication
- Primary and standby setup
- `pg_basebackup` — taking a base backup
- `recovery.conf` (pre-v12) vs. `postgresql.conf` + `standby.signal` (v12+)
- Replication slots — preventing WAL deletion
  - `pg_create_physical_replication_slot()`
  - Slot dangers: disk fill if replica lags
- `pg_stat_replication` — monitoring replication
- Synchronous replication:
  - `synchronous_standby_names`
  - `synchronous_commit` options: `on`, `remote_apply`, `remote_write`, `local`, `off`
- Hot standby — querying replicas
- `hot_standby_feedback` — preventing query cancellation on replica
- Cascading replication
- `pg_rewind` — resynchronizing after failover

### 7.2 Logical Replication
- Logical replication vs. physical replication
- Publications and subscriptions:
  ```sql
  -- On publisher:
  CREATE PUBLICATION my_pub FOR TABLE orders, products;

  -- On subscriber:
  CREATE SUBSCRIPTION my_sub
  CONNECTION 'host=primary dbname=mydb'
  PUBLICATION my_pub;
  ```
- `pg_publication`, `pg_subscription` catalog tables
- Logical decoding — reading WAL as change stream
- `pg_logical_slot_get_changes()`
- Replication identity: `FULL`, `DEFAULT`, `INDEX`, `NOTHING`
- Limitations: DDL not replicated, sequences not replicated
- Use cases: zero-downtime upgrades, selective replication, CDC

### 7.3 Logical Decoding and CDC
- What is Change Data Capture (CDC)?
- Output plugins: `pgoutput` (built-in), `wal2json`, `decoderbufs`
- `pg_recvlogical` — consuming logical changes
- Integration with Debezium for CDC pipelines
- Kafka + Debezium + PostgreSQL architecture

### 7.4 High Availability Tools
- **Patroni:**
  - Architecture: Patroni + DCS (etcd / Consul / ZooKeeper)
  - Leader election and automatic failover
  - `patronictl` commands: `list`, `switchover`, `failover`, `reinit`
  - `patroni.yml` configuration
- **repmgr:**
  - Replication manager
  - `repmgr standby clone`, `repmgr standby promote`
- **pg_auto_failover:**
  - Monitor and automatic failover
  - Simpler than Patroni for smaller setups
- **HAProxy / pgBouncer** — connection routing after failover

---

## Module 8: PostgreSQL Extensions

### 8.1 Extension System
- What are extensions?
- `CREATE EXTENSION`, `DROP EXTENSION`, `ALTER EXTENSION`
- `pg_available_extensions` — listing available extensions
- `pg_extension` — installed extensions
- Extension versioning and upgrades

### 8.2 Essential Extensions
- **`pg_stat_statements`** — query performance tracking
  - `pg_stat_statements` view: `calls`, `total_exec_time`, `rows`, `mean_exec_time`
  - Identifying slow queries
  - `pg_stat_statements_reset()`
- **`pgcrypto`** — cryptographic functions
  - `crypt()`, `gen_salt()`, `pgp_sym_encrypt()`, `digest()`
- **`uuid-ossp`** — UUID generation functions
- **`hstore`** — key-value store in a column
  - Operators: `->`, `@>`, `?`, `||`
  - Now largely superseded by JSONB
- **`ltree`** — hierarchical label trees
  - Efficient ancestor/descendant queries
  - Operators: `@>`, `<@`, `~` (match), `?` (query)
- **`tablefunc`** — crosstab (pivot) queries
  - `crosstab()` function
- **`pg_trgm`** — trigram similarity
  - `similarity()` and `%` operator
  - GIN/GiST trigram indexes for fuzzy search
  - `word_similarity()`, `strict_word_similarity()`
- **`unaccent`** — accent-insensitive search
- **`intarray`** — integer array functions and operators
- **`earthdistance`** — great circle distance calculations
- **`postgis`** — full geographic information system
  - Geometry and geography types
  - Spatial functions: `ST_Distance()`, `ST_Within()`, `ST_Intersects()`
  - Spatial indexes: GiST on geometry columns
- **`timescaledb`** — time-series data extension
  - Hypertables — automatic time-based partitioning
  - Continuous aggregates
  - Compression for old data
- **`pg_partman`** — partition management automation
- **`pgaudit`** — detailed audit logging
- **`pg_repack`** — online table and index bloat removal
- **`pg_cron`** — cron-based job scheduling inside PostgreSQL
- **`postgres_fdw`** — Foreign Data Wrapper for remote PostgreSQL
- **`file_fdw`** — reading CSV files as tables
- **`auto_explain`** — automatic slow query plan logging

### 8.3 Foreign Data Wrappers (FDW)
- What are FDWs?
- `CREATE SERVER`, `CREATE USER MAPPING`, `CREATE FOREIGN TABLE`
- `postgres_fdw` — connecting to other PostgreSQL instances
- `mysql_fdw`, `oracle_fdw` — cross-database queries
- `redis_fdw`, `mongo_fdw` — NoSQL integration
- `file_fdw` — CSV and flat file access
- Performance considerations with FDWs
- Pushdown of WHERE clauses and aggregates

---

## Module 9: PostgreSQL Security Extensions

### 9.1 Row-Level Security (RLS) Deep Dive
- Enabling RLS: `ALTER TABLE ... ENABLE ROW LEVEL SECURITY`
- Creating policies:
  ```sql
  CREATE POLICY user_isolation ON orders
  FOR ALL
  USING (user_id = current_user_id());
  ```
- `USING` vs. `WITH CHECK` clauses
- Policy commands: `ALL`, `SELECT`, `INSERT`, `UPDATE`, `DELETE`
- `BYPASSRLS` role attribute
- `FORCE ROW LEVEL SECURITY` for table owners
- Multi-tenant application patterns with RLS

### 9.2 PostgreSQL Authentication Methods
- `pg_hba.conf` record types: `local`, `host`, `hostssl`, `hostnossl`, `hostgssenc`
- Auth methods: `trust`, `reject`, `md5`, `scram-sha-256`, `gss`, `sspi`, `ldap`, `radius`, `cert`, `pam`
- `scram-sha-256` — recommended modern method
- SSL certificate authentication
- LDAP integration configuration
- `pg_ident.conf` — username mapping

### 9.3 Privilege System Deep Dive
- Default privileges: `ALTER DEFAULT PRIVILEGES`
- Schemas as a security boundary
- `search_path` security implications and injection risks
- Object ownership and `REASSIGN OWNED`
- `SECURITY DEFINER` vs. `SECURITY INVOKER` functions
- `SET ROLE` and `SET SESSION AUTHORIZATION`

---

## Module 10: PostgreSQL Observability

### 10.1 Statistics Views
- **Connection and activity:**
  - `pg_stat_activity` — active queries, state, wait events
  - `pg_stat_bgwriter` — background writer stats
  - `pg_stat_checkpointer` (v16+)
- **Table stats:**
  - `pg_stat_user_tables` — seq scans, index scans, inserts, updates, deletes, dead tuples
  - `pg_statio_user_tables` — buffer hits vs. disk reads
- **Index stats:**
  - `pg_stat_user_indexes` — index scans count
  - `pg_statio_user_indexes` — index buffer hits
- **Database stats:**
  - `pg_stat_database` — transactions, blocks, temp files, conflicts
- **Replication stats:**
  - `pg_stat_replication` — standby lag in bytes and time
  - `pg_stat_replication_slots`
  - `pg_stat_subscription`
- **WAL stats:**
  - `pg_stat_wal` (v14+)
- **Lock monitoring:**
  - `pg_locks` — all current locks
  - `pg_blocking_pids()` — finding blockers
  - Deadlock detection query patterns

### 10.2 Logging Configuration
- `log_min_duration_statement` — slow query logging
- `log_statement` — `none`, `ddl`, `mod`, `all`
- `log_lock_waits` — logging lock waits
- `log_autovacuum_min_duration`
- `log_checkpoints`
- `log_connections` and `log_disconnections`
- `log_line_prefix` — structured log formatting
- Log destinations: `stderr`, `csvlog`, `jsonlog` (v15+), `syslog`
- `pgBadger` — log analysis and reporting

### 10.3 `pg_stat_statements` Deep Dive
- Installation and configuration
- `pg_stat_statements_max` — number of statements tracked
- `track` setting: `top`, `all`, `none`
- Key columns: `queryid`, `calls`, `total_exec_time`, `mean_exec_time`, `stddev_exec_time`, `rows`
- Finding top queries by total time, mean time, calls
- `pg_stat_statements_info` (v14+)
- Resetting stats: `pg_stat_statements_reset()`

### 10.4 Wait Events
- What are wait events?
- Wait event categories: `Lock`, `LWLock`, `IO`, `IPC`, `Timeout`, `Activity`, `Client`, `Extension`
- Common wait events and their meaning:
  - `Lock:relation` — table lock contention
  - `IO:DataFileRead` — reading from disk
  - `LWLock:buffer_content` — buffer pool contention
  - `IPC:BgWorkerStartup`
- Sampling wait events with `pg_stat_activity`
- `pg_wait_sampling` extension for aggregated sampling

---

## Module 11: PostgreSQL Backup and Recovery (Deep Dive)

### 11.1 `pg_dump` and `pg_restore`
- `pg_dump` formats: plain SQL (`-Fp`), custom (`-Fc`), directory (`-Fd`), tar (`-Ft`)
- Selective dumps: `--table`, `--schema`, `--exclude-table`
- Parallel dump with directory format: `-j n`
- `pg_restore` options: `--jobs`, `--section`, `--target-session-attrs`
- `pg_dumpall` — dumping globals (roles, tablespaces)
- Schema-only vs. data-only dumps

### 11.2 Physical Backup and PITR
- `pg_basebackup` — streaming base backup
  - `--wal-method=stream` vs. `--wal-method=fetch`
  - `--checkpoint=fast`
  - `--progress` and `--verbose`
- WAL archiving setup:
  ```ini
  archive_mode = on
  archive_command = 'cp %p /mnt/wal_archive/%f'
  ```
- Restoring with PITR:
  - `restore_command`
  - `recovery_target_time`, `recovery_target_xid`, `recovery_target_lsn`
  - `recovery_target_action`: `promote`, `pause`, `shutdown`
- `pg_waldump` — inspecting WAL for specific changes
- Continuous archiving tools: pgBackRest, Barman, WAL-G

### 11.3 Backup Tools
- **pgBackRest:**
  - Full, differential, and incremental backups
  - Parallel backup and restore
  - Backup verification and integrity checks
  - Encryption and compression
  - `pgbackrest backup`, `pgbackrest restore`, `pgbackrest info`
- **Barman:**
  - Centralized backup management
  - `barman backup`, `barman list-backup`, `barman recover`
  - SSH vs. streaming connection modes
- **WAL-G:**
  - Cloud-native (S3, GCS, Azure Blob Storage)
  - Fast parallel restore
  - `wal-g backup-push`, `wal-g backup-fetch`

---

## Module 12: PostgreSQL Upgrades and Migration

### 12.1 Minor Version Upgrades
- What changes in minor versions (bug fixes, security patches)
- In-place upgrade process
- Zero-downtime minor upgrades with replicas

### 12.2 Major Version Upgrades
- What changes in major versions
- `pg_upgrade` — in-place major version upgrade:
  - `--check` mode — pre-flight validation
  - `--link` mode — hard links instead of copy (faster)
  - Running `analyze_new_cluster.sh` after upgrade
- Logical replication for zero-downtime major upgrade:
  - Set up logical replication to new version
  - Cutover with minimal downtime
- `pglogical` extension for cross-version replication
- Upgrade checklist

### 12.3 Migration to PostgreSQL
- Migrating from MySQL:
  - `pgloader` — automatic migration tool
  - Data type mapping differences
  - SQL dialect differences
- Migrating from Oracle:
  - `ora2pg` — assessment and migration tool
  - Stored procedure translation
  - Sequence and trigger differences
- Migrating from SQL Server:
  - `SSMA for PostgreSQL`
  - T-SQL to PL/pgSQL translation
- Post-migration validation strategies

---

## Module 13: PostgreSQL on the Cloud

### 13.1 Managed PostgreSQL Services
- **Amazon RDS for PostgreSQL** and **Amazon Aurora PostgreSQL:**
  - Differences from vanilla PostgreSQL
  - Aurora's storage architecture
  - Parameter groups and option groups
  - RDS Proxy for connection pooling
- **Google Cloud SQL for PostgreSQL:**
  - High availability configuration
  - Read replicas and failover replicas
- **Azure Database for PostgreSQL:**
  - Flexible Server vs. Single Server (deprecated)
  - Burstable, General Purpose, Memory Optimized tiers
- **Supabase** — PostgreSQL as a backend platform
- **Neon** — serverless PostgreSQL with branching
- **CockroachDB** — distributed PostgreSQL-compatible
- **YugabyteDB** — distributed PostgreSQL-compatible

### 13.2 Cloud-Specific Considerations
- Extension availability on managed services
- Superuser restrictions on managed services
- Backup and PITR on managed services
- Connection limits and pooling strategies
- Costs: storage, I/O, data transfer
- VPC and network security

---

## Module 14: Practice and PostgreSQL Projects

### 14.1 PostgreSQL-Specific Practice
- `pgexercises.com` — PostgreSQL-focused exercises
- Designing multi-tenant systems with RLS
- Building a full-text search engine with `tsvector`
- Time-series analysis with `generate_series()` and window functions
- Implementing a job queue with `SKIP LOCKED`
  ```sql
  SELECT * FROM job_queue
  WHERE status = 'pending'
  ORDER BY created_at
  FOR UPDATE SKIP LOCKED
  LIMIT 1;
  ```

### 14.2 Suggested PostgreSQL Projects
- **Beginner:** Set up PostgreSQL locally, configure `pg_hba.conf`, create roles and schemas
- **Intermediate:** Build a multi-tenant SaaS schema with RLS, JSONB metadata, and audit triggers
- **Advanced:** Set up streaming replication with Patroni, pgBouncer, and HAProxy
- **Analytics:** Implement a star schema with partitioned fact tables and materialized view refresh
- **DevOps:** Automate backups with pgBackRest or WAL-G to S3, test PITR recovery

### 14.3 Recommended PostgreSQL Resources

| Type | Resource |
|---|---|
| Book | *PostgreSQL: Up and Running* — Regina Obe and Leo Hsu |
| Book | *The Art of PostgreSQL* — Dimitri Fontaine |
| Book | *PostgreSQL 14 Internals* — Egor Rogov (free online) |
| Book | *Mastering PostgreSQL* — Hans-Jürgen Schönig |
| Website | postgresql.org/docs — official documentation |
| Website | postgresqlco.nf — configuration reference |
| Website | use-the-index-luke.com — indexing deep dive |
| Website | pgpedia.info — PostgreSQL encyclopedia |
| Tool | pgAdmin 4 — GUI administration |
| Tool | DBeaver — cross-database GUI |
| Tool | DataGrip — JetBrains IDE for databases |
| Tool | pgBadger — log analysis |
| Community | PostgreSQL mailing lists (pgsql-general, pgsql-performance) |
| Community | PostgreSQL Weekly newsletter |

---