Based on **Part 19** of your Table of Contents, here is a detailed explanation of the **Authorization Endpoint**.

---

# 19. Authorization Endpoint

The **Authorization Endpoint** is the "front door" of the OAuth 2.0 flow. It is the URL where the Client Application sends the user (Resource Owner) to log in and grant permissions.

Unlike other API endpoints (like the Token Endpoint), which are accessed via back-channel HTTP requests from server to server, the Authorization Endpoint is accessed via the **User Agent (Browser)**.

### 1. Purpose & Behavior
The primary purpose of this endpoint is to separate the Client from the User's credentials. instead of the User typing their password into the Client App, they are redirected to the Authorization Server.

**The Workflow:**
1.  **Redirect:** The Client constructs a URL and redirects the user's browser to the Authorization Endpoint.
2.  **Authentication:** The Authorization Server checks if the user is logged in. If not, it presents a login form (Username/Password, MFA, SSO, etc.).
3.  **Consent:** The Server asks the user: *"Do you want to allow [Client App] to access [Scope]?"*
4.  **Callback:** If the user approves, the Server redirects the browser back to the Client's `redirect_uri` with an authorization code (or token).

### 2. Request Parameters
When the Client redirects the user, it includes specific query parameters in the URL so the Authorization Server knows what is being requested.

**Example Request URL:**
```http
GET /authorize?
  response_type=code
  &client_id=my-app-123
  &redirect_uri=https://my-app.com/callback
  &scope=read_contacts openid
  &state=xyz123secure
  &code_challenge=E9Melhoa2O...
  &code_challenge_method=S256 HTTP/1.1
Host: auth-server.com
```

**Standard Parameters:**

| Parameter | Required? | Description |
| :--- | :--- | :--- |
| **`response_type`** | **Yes** | Tells the server what flow is being used. <br>• Use `code` for Authorization Code Flow (Standard).<br>• Use `token` for Implicit Flow (Deprecated/Removed in OAuth 2.1). |
| **`client_id`** | **Yes** | The public identifier for the application requesting access. |
| **`redirect_uri`** | Optional* | The URL where the user should be sent back involves after logging in. <br>*(Strictly required in OAuth 2.1 or if the client has multiple URIs registered).* |
| **`scope`** | Optional | A space-separated list of permissions requested (e.g., `read:profile write:email`). |
| **`state`** | Recommended | A random string string generated by the Client to prevent **CSRF attacks**. The server returns this exact value unchanged. |
| **`code_challenge`** | **Yes** (OAuth 2.1) | Used for **PKCE** (Proof Key for Code Exchange). It is a hashed version of a secret created by the client. |
| **`code_challenge_method`** | **Yes** (OAuth 2.1) | Usually `S256`. Describes how the code challenge was hashed. |
| **`prompt`** | Optional | Hints to the server about user interaction.<br>• `none`: Do not show UI (fail if user isn't logged in).<br>• `login`: Force the user to log in again.<br>• `consent`: Force the consent screen even if already given. |

### 3. Response Modes
The "Response Mode" determines *how* the Authorization Server sends parameters back to the Client. This is controlled by the `response_mode` parameter (or implied by `response_type`).

#### A. Query Mode (Default for `response_type=code`)
The server appends the parameters to the query string (`?`).
*   **Best for:** Web servers that can parse incoming GET requests.
*   **Example:**
    ```
    HTTP/1.1 302 Found
    Location: https://client.com/callback?code=AuthorizatonCode&state=xyz123
    ```

#### B. Fragment Mode (Default for `response_type=token`)
The server appends parameters after the hash fragment (`#`). The browser does **not** send the fragment to the backend server; it is only visible to JavaScript running in the browser.
*   **Best for:** Old Single Page Apps (Implicit Flow).
*   **Example:**
    ```
    Location: https://client.com/callback#access_token=mF_9.B5f-4&token_type=Bearer
    ```
    *Note: Since Implicit Grant is removed in OAuth 2.1, this mode is rarely used now.*

#### C. Form Post Mode (`response_mode=form_post`)
Instead of a redirect 302, the server returns an HTML page containing a `<form>` with hidden inputs and a script that automatically POSTs the form to the `redirect_uri`.
*   **Best for:** Sending sensitive data that shouldn't appear in the browser URL history or logs.

### 4. User Interaction & Consent
This endpoint is unique because it involves a **human**.

1.  **Authentication:** The mechanism (password, FaceID, YubiKey) is strictly between the User and the Authorization Server. The Client application never sees the credentials.
2.  **Consent UI:** The server displays a page showing:
    *   The name of the Client.
    *   The Scopes requested (e.g., "See your Google Photos").
    *   "Allow" and "Deny" buttons.
3.  **Remembering Decisions:** Servers often remember "Allow" clicks. If the user logs in again later, the Concent step might be skipped (unless `prompt=consent` is used).

### 5. Error Responses
If the request fails, the Authorization Server usually redirects back to the `redirect_uri` with an `error` parameter in the query string.

**Common Error Codes:**
*   `access_denied`: The most common error. The user clicked "Cancel" or "Deny" on the consent screen.
*   `invalid_request`: Missing parameter (e.g., no `client_id`).
*   `unauthorized_client`: The client is not allowed to use this flow (e.g., a server-side app trying to use Implicit flow).
*   `unsupported_response_type`: The server doesn't support the requested flow.
*   `invalid_scope`: The client asked for a scope that doesn't exist or isn't allowed.

**Critical Exception:**
If the `redirect_uri` is missing or does not match the one registered with the Authorization Server, the server **must not** redirect. Instead, it shows a generic error page to the user directly on the Authorization Server to to prevent **Open Redirector attacks**.
