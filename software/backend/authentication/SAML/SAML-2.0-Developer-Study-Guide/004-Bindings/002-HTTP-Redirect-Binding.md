Based on Part 4, Item 20 of your Table of Contents, here is a detailed explanation of the **HTTP Redirect Binding**.

---

# 20. HTTP Redirect Binding

The **HTTP Redirect Binding** is one of the foundational mechanisms in SAML 2.0. It defines how SAML protocol messages can be transmitted within URL parameters using the HTTP GET method.

Because the message is sent via the URL, the user agent (browser) is technically "redirected" from one entity (e.g., the Service Provider) to another (e.g., the Identity Provider).

## 1. How It Works
The standard flow for this binding usually occurs during the **SP-Initiated SSO** process.

1.  **Generation:** The Service Provider (SP) generates a SAML request (usually an `AuthnRequest`).
2.  **Encoding:** Because XML is verbose and URLs have length limits, the SP must compress and encode the XML.
3.  **Construction:** The SP constructs a URL that targets the IdPâ€™s Single Sign-On Service endpoint. It appends the encoded XML as a query string parameter named `SAMLRequest`.
4.  **Redirect:** The SP sends an HTTP 302 (Found) or 303 (See Other) response to the user's browser with this constructed URL in the `Location` header.
5.  **Transmission:** The browser automatically sends a GET request to the IdP using that URL.

## 2. The Encoding Pipeline (Deflate & URL Encoding)
This is the most critical technical aspect of this binding. You cannot simply put raw XML into a URL. The specification mandates a strict ordering of operations to ensure the message fits in the URL and passes through firewalls/proxies safely.

The pipeline is **DEFLATE $\rightarrow$ Base64 $\rightarrow$ URL-Encode**.

### Step A: Deflate Compression
The raw SAML XML is compressed using the **DEFLATE** algorithm (RFC 1951).
*   *Note:* The header and trailer generated by the gzip algorithm are **not** included. It is raw deflate.
*   *Reason:* XML is text-heavy and compresses very well (often reducing size by 70-90%), which is necessary to fit within browser URL limits.

### Step B: Base64 Encoding
The binary result of the Deflate compression is then **Base64 encoded**. This turns the binary data into a standard ASCII string.

### Step C: URL Encoding
Finally, the Base64 string is **URL-encoded** (percent-encoded). This ensures that characters like `+`, `=`, and `/` (common in Base64) are interpreted correctly as data, not as URL delimiters.

**Example:**
> **Raw:** `<samlp:AuthnRequest ...>`
> **Final URL param:** `...&SAMLRequest=nZBdSwMxDIX%2FSnLfNmnrPijdWBDEnYILvT...`

---

## 3. Signature in Query String
In the HTTP POST Binding, signatures are embedded digitally *inside* the XML (using XML-DSig). However, in the Redirect Binding, the XML is compressed and encoded, making it difficult to sign the XML structure directly.

Instead, the signature is transmitted as a **separate query parameter**.

### The Signing Algorithm
To verify the message, the receiver must concatenate the raw query string parameters (before URL-decoding) in a specific order:

```text
SAMLRequest=value&RelayState=value&SigAlg=value
```

1.  **SAMLRequest:** The encoded message.
2.  **RelayState:** (Optional) State information maintained by the sender (e.g., the deep link the user was trying to access).
3.  **SigAlg:** The URI of the algorithm used to sign (e.g., `http://www.w3.org/2001/04/xmldsig-more#rsa-sha256`).

The sender calculates the crypto-signature of this concatenated string and appends it as the `&Signature=` parameter.

**Key Developer Gotcha:** Do not check for an embedded XML signature inside the `SAMLRequest` XML when using Redirect Binding. You must validate the `Signature` query parameter against the parameters in the URL.

---

## 4. Size Limitations
This is the primary constraint of the Redirect Binding.

*   **Browser Limits:** While modern browsers support very long URLs (60,000+ characters), older browsers (Internet Explorer) had limits around 2,048 characters.
*   **Server Limits:** Web servers (Nginx, Apache, IIS) often have default limits on the size of HTTP Request Headers or Request Lines (often 4KB to 8KB).

Because of this, **Redirect Binding is rarely used for sending the final SAML Response (Assertion)**. An Assertion contains digital signatures, attributes, and bulky XML, which will almost always exceed URL length limits.

---

## 5. Use Cases

### When to use HTTP Redirect:
1.  **AuthnRequest (SP $\rightarrow$ IdP):** This is the standard use case. The request is small (usually just "Who is this user?" and specific policy flags), so it compresses easily to under 1KB.
2.  **LogoutRequest (SP $\leftrightarrow$ IdP):** Logout messages are typically just a Session ID and a NameID, which are small enough for a URL.
3.  **ArtifactResolve (SP $\rightarrow$ IdP):** When using the Artifact binding, the resolution request is small.

### When NOT to use HTTP Redirect:
1.  **SAML Response (IdP $\rightarrow$ SP):** Never use Redirect for the Assertion delivery. It will fail due to size limits. Use **HTTP POST Binding** for this.

---

## Summary Comparision

| Feature | HTTP Redirect Binding | HTTP POST Binding |
| :--- | :--- | :--- |
| **Transport** | URL Query Parameters (GET) | HTML Form Data (POST) |
| **Compression** | **Required** (Deflate) | None (usually) |
| **Signature** | Detached (Query Param) | Embedded (XML-DSig) |
| **Size Capacity** | Low (< 2KB - 4KB safe zone) | High (Unlimited) |
| **Primary Usage** | **Requests** (AuthnRequest) | **Responses** (Assertions) |
