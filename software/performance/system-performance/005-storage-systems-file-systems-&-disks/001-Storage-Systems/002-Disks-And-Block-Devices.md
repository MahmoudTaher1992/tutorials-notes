# Disks & Block Devices (Chapter 9)

- **Terminology & Models**
    - **Block Interface**: The simple "read/write block X" contract
    - **Rotational Media (HDD)**: Platters, Spindles, Actuator Arms
    - **Solid State Drives (SSD/NVMe)**: Flash memory, Wear leveling, Garbage collection
- **Core Concepts**
    - **Time Scales**: The massive gap between CPU cycles and Disk I/O (The "Grand Canyon" of performance)
    - **IOPS** (Input/Output Operations Per Second): The standard throughput metric
    - **I/O Size**: How 4KB I/O differs from 1MB I/O in throughput calculation
    - **Seek Time & Rotational Latency**: The physics of HDDs
    - **Utilization**: Time the device is busy
    - **Saturation**: Wait queues forming
    - **I/O Wait**: CPU time spent waiting on disk (idle but blocked)
- **Disk Architecture**
    - **Interfaces**:
        - SATA/SAS (Legacy queues)
        - NVMe (Modern, massive parallelism, deep queues)
    - **RAID**: Striping (0), Mirroring (1), Parity (5/6) and their write penalties
    - **The Block Layer**: The OS layer dealing with queues and merging requests
- **Analysis Methodology**
    - **The USE Method**:
        - Utilization: % busy
        - Saturation: Average Queue Length / Wait time
        - Errors: SCSI/device errors
    - **Bi-Modal Latency**: Identifying the difference between Cache hits (on-disk buffer) and Physics (mechanical movement)
- **Disk Observability Tools**
    - **The Standard**: `iostat` (The most critical tool for disks)
        - Understanding `%util`, `avgqu-sz`, `await`, `svctm`
    - **Latency Analysis**:
        - `biolatency`: Histogram of block I/O latency (eBPF)
        - `biosnoop`: Per-request latency logging
    - **Workload Analysis**:
        - `biotop`: Top processes by disk I/O
        - `blktrace`: The ultimate low-level event tracer for the block layer
    - **Hardware Info**: `smartctl` (SMART stats), `megacli` (RAID controller stats)
- **Visualizations**
    - **Latency Heat Maps**: The best way to see outliers and multimodal distributions
    - **Offset Heat Maps**: Visualizing access patterns (Sequential bands vs. Random clouds)
- **Tuning**
    - **I/O Schedulers**:
        - `mq-deadline`: Simple, good for fast storage
        - `bfq`: Complex, focuses on interactive desktop responsiveness
        - `kyber`: Designed for fast NVMe devices
        - `none`: Letting the device handle it (common for high-end NVMe)
    - **Queue Depths**: Tuning hardware queues
    - **Read-Ahead**: Tuning `read_ahead_kb` at the block level
